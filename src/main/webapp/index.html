<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ToDoList</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
	<h1>ToDoList</h1>
	<div class="container">
		<div class="left-box">왼쪽</div>
		<div class="box">
			가운데 <input id="todoInput" type="text" placeholder="일정을 적어주세요.">
			<button id="addButton">일정 추가</button>
			<button id="loadButton">일정 목록</button>
			<ul id="todolist">
				<p id="emptylist">일정이 비어있습니다.</p>
			</ul>
		</div>
		<div class="right-box">오른쪽</div>
	</div>

	<input>
	<button>로그인</button>
	<script>
	// 일정 추가
	document.getElementById("addButton").addEventListener("click", function() {
    const todo = document.getElementById("todoInput").value;
    if(!todo){
        alert("일정을 입력해주세요.");
        return;
    }

    // 서버에 저장
    fetch("http://localhost:8080/api/todo/add", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(todo)
    })
    .then(response => {
        if(response.ok) {
            alert("일정이 추가되었습니다!");
            document.getElementById("todoInput").value = "";
			document.getElementById("emptylist").style.display="none";		// 일정 추가 시 "일정이 없습니다" 문구 제거, 이거 if문 사용해서 일정 없을 때만 문구 있고 
																// 일정 있을 때는 문구가 안보이게 만들어야됨, 일정을 삭제해서 하나도 없을 때는 다시 문구가 보이도록 만들어야함
            // li와 버튼 생성
            const list = document.getElementById("todolist");
            const li = document.createElement("li");
            const deleteBtn = document.createElement("button");
            // deleteBtn.id="${todoId}-deleteBtn";
            const updateBtn = document.createElement("button");

            // 고유 id
            const todoId = list.children.length;
            li.id = `todo-${todoId}`;
            li.className = "todo";
            li.textContent = `${todo}`;

            updateBtn.textContent = "수정";
            deleteBtn.textContent = "삭제";

            // 수정 기능 추가해야됨
            updateBtn.addEventListener("click", function() {
                fetch(`http://localhost:8080/api/todo/update/${todoId}`, { method: "POST" })
                .then(response => {
                    if(response.ok){
                    	alert("일정이 삭제되었습니다.");
                        li.remove();
                        updateBtn.remove();
                        deleteBtn.remove();
                    }
                });
            });
            
            // 삭제 기능 추가 
            deleteBtn.addEventListener("click", function() {
                fetch(`http://localhost:8080/api/todo/delete/${todoId}`, { method: "POST" })
                .then(response => {
                    if(response.ok){
                    	alert("일정이 삭제되었습니다.");
                        li.remove();
                        updateBtn.remove();
                        deleteBtn.remove();
                        const list_ul = document.getElementById("todolist");
                        const todo_li = list_ul.querySelectorAll("li");
                        if(todo_li===0){
                        	document.getElementById("emptylist").style.display="block";	
                        }
                        
                    }
                });
            });
            
            

            list.appendChild(li);
            list.appendChild(updateBtn);
            list.appendChild(deleteBtn);
        }
    })
    .catch(error => console.error(error));
});
	
	</script>
</body>
</html>